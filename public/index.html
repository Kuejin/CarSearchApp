<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Car Search</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #2b3d56;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .tabs {   
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      gap: 0; /* 버튼 사이 여백 제거 */
      width: 100%;
      max-width: 550px;
    }

    .tab-button {
      flex: 1; /* 각 버튼이 절반 너비 차지 */
      padding: 10px 0;
      font-size: 16px;
      border: none;
      background-color: #2e5b7f;
      color: white;
      border-radius: 0;
      cursor: pointer;
      border-bottom: 2px solid transparent; /* 기본 상태에서 선 없음 */
      transition: border-color 0.5s;
    }

    .tab-button.active {
      border-bottom: 2px solid white; /* 활성 탭 하단 흰색 선 */
      background-color: #16364d;
      font-weight: bold;
    }

    .section {
      display: none;
      width: 100%;
      max-width: 550px;
      background-color: #2b3d56;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 40px;
    }

    .section.active {
      display: block;
    }

    h1 {
      font-size: 28px;
      margin-top: 0;
      margin-bottom: 20px;
      color: white;
      text-align: center;
      border-bottom: 2px solid white;
      padding-bottom: 10px;
    }

    input {
      display: block;
      width: 500px;
      margin: 10px auto;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 9999px;
      box-sizing: border-box;
      outline: none;
    }

    input.invalid {
      border: 2px solid red;
    }

    #car_number,
    #add_car_number {
      padding: 20px;
      font-weight: bold;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #2e5b7f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }

    button:hover {
      background-color: #244d6c;
    }

    #result {
      margin-top: 20px;
      max-width: 550px;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 10px;
      max-height: 400px;
      overflow-y: auto;
    }

    .result-item {
      margin-bottom: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.3);
      padding-bottom: 10px;
    }

    .result-item div {
      margin: 5px 0;
    }

    @media (max-width: 600px) {
      input {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="tabs">
    <button class="tab-button active" onclick="showTab('search')">차량 검색</button>
    <button class="tab-button" onclick="showTab('add')">차량 추가</button>
  </div>

  <div id="search" class="section active">
    <form id="search-form" onsubmit="event.preventDefault(); searchCar();">
      <input placeholder="차 번호" id="car_number">
      <input placeholder="차 종류" id="car_type">
      <input placeholder="차 색상" id="car_color">
      <input placeholder="차 주인" id="owner_name">
      <input placeholder="폰 번호" id="phone_number">
      <button type="submit">검색</button>
    </form>
  </div>

  <div id="add" class="section">
    <form id="add-form" onsubmit="event.preventDefault(); addCar();">
      <input placeholder="차 번호" id="add_car_number">
      <input placeholder="차 종류" id="add_car_type">
      <input placeholder="차 색상" id="add_car_color">
      <input placeholder="차 주인" id="add_owner_name">
      <input placeholder="폰 번호" id="add_phone_number">
      <button type="submit">추가</button>
    </form>
  </div>

  <div id="result"></div>

  <script>
    function showTab(tabName) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      const activeButton = Array.from(document.querySelectorAll('.tab-button'))
        .find(btn => btn.textContent.includes(tabName === 'search' ? '검색' : '추가'));
      activeButton.classList.add('active');

      document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
    }

    function validateInputs(inputIds) {
      let valid = true;
      inputIds.forEach(id => {
        const input = document.getElementById(id);
        if (!input.value.trim()) {
          valid = false;
        } else {
        }
      });
      return valid;
    }

    async function searchCar() {
      const inputIds = ['car_number', 'car_type', 'car_color', 'owner_name', 'phone_number'];
      const params = new URLSearchParams();
      inputIds.forEach(id => {
        params.append(id, document.getElementById(id).value);
      });

      const res = await fetch(`/search?${params}`);
      const data = await res.json();

      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '';

      if (Array.isArray(data) && data.length > 0) {
        data.forEach(car => {
          const item = document.createElement('div');
          item.className = 'result-item';
          item.innerHTML = `
            <div>${car.car_number}</div>
            <div>${car.car_type}</div>
            <div>${car.car_color}</div>
            <div>${car.owner_name}</div>
            <div>${car.phone_number}</div>
          `;
          resultDiv.appendChild(item);
        });
      } else {
        resultDiv.textContent = '결과가 없습니다.';
      }
    }

    async function addCar() {
      const inputIds = ['add_car_number', 'add_car_type', 'add_car_color', 'add_owner_name', 'add_phone_number'];
      if (!validateInputs(inputIds)) {
        alert("모든 입력값을 채워주세요.");
        return;
      }

      const body = {};
      inputIds.forEach(id => {
        body[id.replace('add_', '')] = document.getElementById(id).value;
      });

      const res = await fetch('/add', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(body)
      });

      const data = await res.json();
      if (data.message && data.message.includes('성공')) {
        alert('등록 성공했습니다');
        // 입력값 초기화
        inputIds.forEach(id => document.getElementById(id).value = '');
      } else {
        alert(data.message || '등록 실패');
      }
    }
  </script>
</body>
</html>
